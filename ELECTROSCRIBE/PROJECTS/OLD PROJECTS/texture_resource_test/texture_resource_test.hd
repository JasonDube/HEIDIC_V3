// TextureResource Test Project
// Tests the TextureResource class - automatically loads DDS or PNG textures

extern fn heidic_glfw_vulkan_hints(): void;
extern fn heidic_init_renderer_texture_quad(window: GLFWwindow, texturePath: string): i32;
extern fn heidic_render_texture_quad(window: GLFWwindow): void;
extern fn heidic_cleanup_renderer_texture_quad(): void;
extern fn heidic_sleep_ms(milliseconds: i32): void;

fn main(): void {
    print("=== TextureResource Test ===\n");
    print("Tests TextureResource class with automatic DDS/PNG detection\n");
    print("Initializing GLFW...\n");

    let init_result: i32 = glfwInit();
    if init_result == 0 {
        print("Failed to initialize GLFW!\n");
        return;
    }

    print("GLFW initialized.\n");
    heidic_glfw_vulkan_hints();
    
    print("Creating window (800x600)...\n");
    let window: GLFWwindow = glfwCreateWindow(800, 600, "TextureResource Test", 0, 0);
    if window == 0 {
        print("Failed to create window!\n");
        glfwTerminate();
        return;
    }

    print("Window created.\n");
    print("Initializing TextureResource renderer...\n");
    print("TextureResource will auto-detect DDS or PNG format!\n");

    // Try loading a DDS texture first (if available)
    // You can also try "textures/test.png" to test PNG loading
    let renderer_init: i32 = heidic_init_renderer_texture_quad(window, "textures/test.dds");
    if renderer_init == 0 {
        // Fallback to PNG if DDS doesn't exist
        print("DDS not found, trying PNG...\n");
        renderer_init = heidic_init_renderer_texture_quad(window, "textures/test.png");
        if renderer_init == 0 {
            print("Failed to initialize TextureResource renderer!\n");
            print("Make sure textures/test.dds or textures/test.png exists!\n");
            glfwDestroyWindow(window);
            glfwTerminate();
            return;
        }
    }

    print("TextureResource renderer initialized!\n");
    print("Starting render loop...\n");
    print("You should see the texture on a fullscreen quad!\n");
    print("Press ESC or close the window to exit.\n");

    while glfwWindowShouldClose(window) == 0 {
        glfwPollEvents();

        if glfwGetKey(window, 256) == 1 { // ESC key
            glfwSetWindowShouldClose(window, 1);
        }

        heidic_render_texture_quad(window);
        heidic_sleep_ms(16); // ~60 FPS cap
    }

    print("Cleaning up...\n");
    heidic_cleanup_renderer_texture_quad();
    glfwDestroyWindow(window);
    glfwTerminate();
    print("Done!\n");
}