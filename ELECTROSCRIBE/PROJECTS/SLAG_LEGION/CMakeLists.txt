# SLAG LEGION - CMake Build Configuration
# Uses clean, modular SL Engine (no legacy eden_vulkan_helpers)

cmake_minimum_required(VERSION 3.16)
project(SLAG_LEGION VERSION 0.1.0)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Find Vulkan
find_package(Vulkan REQUIRED)

# Find GLFW (assumes it's installed or provide path)
find_package(glfw3 REQUIRED)

# Project root for includes
set(HEIDIC_ROOT "${CMAKE_CURRENT_SOURCE_DIR}/../../..")

# SL Engine sources
set(SL_ENGINE_SOURCES
    engine/sl_engine.cpp
    engine/sl_api.cpp
)

# Raycast utilities from extracted modules
set(RAYCAST_SOURCES
    ${HEIDIC_ROOT}/vulkan/utils/raycast.cpp
)

# Main game source (generated by HEIDIC compiler)
set(GAME_SOURCES
    slag_legion.cpp
)

# Create executable
add_executable(slag_legion
    ${GAME_SOURCES}
    ${SL_ENGINE_SOURCES}
    ${RAYCAST_SOURCES}
)

# Include directories
target_include_directories(slag_legion PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/engine
    ${HEIDIC_ROOT}
    ${HEIDIC_ROOT}/vulkan
    ${HEIDIC_ROOT}/third_party
    ${Vulkan_INCLUDE_DIRS}
)

# Link libraries
target_link_libraries(slag_legion PRIVATE
    Vulkan::Vulkan
    glfw
)

# Windows-specific
if(WIN32)
    target_compile_definitions(slag_legion PRIVATE
        WIN32_LEAN_AND_MEAN
        NOMINMAX
        VK_USE_PLATFORM_WIN32_KHR
    )
endif()

# Copy assets to build directory
file(COPY 
    ${CMAKE_CURRENT_SOURCE_DIR}/crosshair.png
    ${CMAKE_CURRENT_SOURCE_DIR}/items.json
    DESTINATION ${CMAKE_CURRENT_BINARY_DIR}
)

if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/fonts)
    file(COPY ${CMAKE_CURRENT_SOURCE_DIR}/fonts DESTINATION ${CMAKE_CURRENT_BINARY_DIR})
endif()

